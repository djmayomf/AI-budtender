<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Page</title>
</head>
<body>
    <h1 id="product-name"></h1>
    <p id="product-description"></p>
    <p>Price: $<span id="product-price"></span></p>
    <p>Weight: <span id="product-weight"></span> g</p>
    <p id="product-availability"></p>
    <p>Deals: <span id="product-deals"></span></p>
    <p>Promos: <span id="product-promos"></span></p>

    <button onclick="addToCart()">Add to Cart</button>
    <button onclick="addToWishlist()">Add to Wishlist</button>

    <h2>Strains from Leafly</h2>
    <button onclick="fetchLeaflyStrains()">Fetch Leafly Strains</button>
    <ul id="leafly-strains"></ul>

    <h2>Deals from Weedmaps</h2>
    <button onclick="fetchWeedmapsDeals()">Fetch Weedmaps Deals</button>
    <ul id="weedmaps-deals"></ul>

    <h2>Recommendations</h2>
    <button onclick="fetchRecommendations()">Fetch Recommendations</button>
    <ul id="recommendations"></ul>

    <h2>Submit Feedback</h2>
    <input type="number" id="user-id" placeholder="User ID">
    <input type="number" id="product-id" placeholder="Product ID">
    <input type="number" id="rating" placeholder="Rating (1-5)">
    <button onclick="submitFeedback()">Submit Feedback</button>

    <h2>Upload ID</h2>
    <form action="/upload_id" method="post" enctype="multipart/form-data">
        <input type="hidden" name="user_id" value="USER_ID_HERE">
        <input type="file" name="file" accept="image/*" required>
        <button type="submit">Upload ID</button>
    </form>

    <script>
        const productId = 1; // Replace with dynamic product ID

        function fetchProduct() {
            fetch(`/product/${productId}`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('product-name').innerText = data.name;
                    document.getElementById('product-description').innerText = data.description;
                    document.getElementById('product-price').innerText = data.price;
                    document.getElementById('product-weight').innerText = data.weight;
                    document.getElementById('product-availability').innerText = data.availability ? 'In Stock' : 'Out of Stock';
                    document.getElementById('product-deals').innerText = data.deals;
                    document.getElementById('product-promos').innerText = data.promos;
                });
        }

        function addToCart() {
            fetch(`/product/${productId}/add_to_cart`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ quantity: 1 }) // Adjust as needed
            })
            .then(response => response.json())
            .then(data => {
                alert('Product added to cart!');
            });
        }

        function addToWishlist() {
            fetch(`/product/${productId}/add_to_wishlist`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ user_id: 1 }) // Adjust as needed
            })
            .then(response => response.json())
            .then(data => {
                alert('Product added to wishlist!');
            });
        }

        function fetchLeaflyStrains() {
            fetch('/scrape/leafly/strains')
                .then(response => response.json())
                .then(data => {
                    const list = document.getElementById('leafly-strains');
                    list.innerHTML = '';
                    data.forEach(strain => {
                        const item = document.createElement('li');
                        item.textContent = `${strain.name}: ${strain.description}`;
                        list.appendChild(item);
                    });
                });
        }

        function fetchWeedmapsDeals() {
            fetch('/scrape/weedmaps/deals')
                .then(response => response.json())
                .then(data => {
                    const list = document.getElementById('weedmaps-deals');
                    list.innerHTML = '';
                    data.forEach(deal => {
                        const item = document.createElement('li');
                        item.textContent = `${deal.title}: ${deal.description}`;
                        list.appendChild(item);
                    });
                });
        }

        function fetchRecommendations() {
            const userId = document.getElementById('user-id').value;
            fetch(`/recommendations?user_id=${userId}`)
                .then(response => response.json())
                .then(data => {
                    const list = document.getElementById('recommendations');
                    list.innerHTML = '';
                    data.forEach(productId => {
                        const item = document.createElement('li');
                        item.textContent = `Product ID: ${productId}`;
                        list.appendChild(item);
                    });
                });
        }

        function submitFeedback() {
            const userId = document.getElementById('user-id').value;
            const productId = document.getElementById('product-id').value;
            const rating = document.getElementById('rating').value;

            fetch('/feedback', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ user_id: userId, product_id: productId, rating: rating }),
            })
            .then(response => response.json())
            .then(data => {
                alert(data.status);
            });
        }

        fetchProduct();
    </script>
</body>
</html>